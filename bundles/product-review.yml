version: '3.7'
services:
  # Storefront Product Review app container (magento/storefront-product-reviews-ce repo)
  app-product-reviews:
    image: rkostiv/php-with-rr-grpc
    hostname: app-product-reviews
    working_dir: /var/www/storefront-product-reviews-ce
    ports:
      - "227:22" #ssh
    stop_signal: SIGKILL
    env_file:
      - ../.env
    volumes:
      - code:/var/www
      - ../etc/php/xdebug.ini:/usr/local/etc/php/conf.d/xdebug.ini
      - ../etc/php/tools:/usr/local/bin/magento2:ro
      - ../etc/php/php.ini:/usr/local/etc/php/php.ini:ro
      - ../etc/php/php-fpm.conf:/usr/local/etc/php-fpm.conf
    environment:
      COMPOSER_HOME: /var/www/.composer
      PHP_IDE_CONFIG: serverName=app-product-reviews
    command: sh -c 'service ssh start; php-fpm -R'

