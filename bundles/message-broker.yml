version: '3.7'
services:
  # Message Broker container (magento/storefront-message-broker repo)
  message-broker:
    image: rkostiv/php-with-rr-grpc
    hostname: message-broker
    working_dir: /var/www/storefront-message-broker
    ports:
      - "223:22" #ssh
    stop_signal: SIGKILL
    env_file:
      - ../.env
    volumes:
      - code:/var/www
      - ../etc/php/xdebug.ini:/usr/local/etc/php/conf.d/xdebug.ini
      - ../etc/php/tools:/usr/local/bin/magento2:ro
      - ../etc/php/php.ini:/usr/local/etc/php/php.ini:ro
      - ../etc/php/php-fpm.conf:/usr/local/etc/php-fpm.conf
    environment:
      COMPOSER_HOME: /var/www/.composer
      PHP_IDE_CONFIG: serverName=message-broker
    command: sh -c 'service ssh start; php-fpm -R'